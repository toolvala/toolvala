<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Word & Text to PDF Converter (Fixed Layout) | 2025 Tool</title>
    <meta name="description" content="Convert Word documents and Text to PDF with proper A4/A3 formatting. Supports Hindi/Marathi fonts and secure offline conversion.">
    
    <!-- Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <style>
        :root {
            --primary: #2563eb;
            --bg: #f3f4f6;
            --text: #1f2937;
        }

        body {
            font-family: 'Segoe UI', 'Mangal', 'Nirmala UI', Roboto, sans-serif; /* Added Hindi Fonts */
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        /* Tool Box */
        .tool-box {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            text-align: center;
        }

        .tab-btn {
            padding: 10px 20px;
            cursor: pointer;
            background: #e5e7eb;
            border: none;
            border-radius: 5px;
            margin: 0 5px;
            font-weight: bold;
        }
        .tab-btn.active { background: var(--primary); color: white; }

        .tab-content { display: none; margin-top: 20px; }
        .tab-content.active { display: block; }

        textarea {
            width: 100%;
            height: 150px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-family: inherit; /* Inherit font for Hindi support */
        }

        /* PREVIEW AREA - THE IMPORTANT FIX */
        #preview-wrapper {
            margin-top: 30px;
            background: #525659; /* PDF Viewer Background color */
            padding: 40px;
            overflow-x: auto;
            display: none;
            border-radius: 8px;
        }

        #preview-container {
            background: white;
            margin: 0 auto;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            /* Default A4 Dimensions */
            width: 210mm; 
            min-height: 297mm;
            padding: 15mm; /* Margins inside the paper */
            box-sizing: border-box; 
            text-align: left;
            color: black;
        }

        /* Content Styling Fixes */
        #document-content {
            font-size: 12pt;
            line-height: 1.5;
            width: 100%;
            word-wrap: break-word; /* Forces long words to break */
            overflow-wrap: break-word;
        }
        
        #document-content p {
            margin-bottom: 1em;
            white-space: pre-wrap; /* Preserves spaces/newlines correctly */
        }

        #document-content img {
            max-width: 100%;
            height: auto;
        }

        .controls {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        button.action-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
        }
        
        button.action-btn:disabled { background: #ccc; }

        select { padding: 10px; border-radius: 6px; border: 1px solid #ccc; }

    </style>
</head>
<body>

<div class="container">
    <div class="tool-box">
        <h2>Word/Text to PDF Converter</h2>
        
        <div>
            <button class="tab-btn active" onclick="setMode('file')">Upload DOCX</button>
            <button class="tab-btn" onclick="setMode('text')">Paste Text</button>
        </div>

        <!-- File Upload -->
        <div id="tab-file" class="tab-content active">
            <div style="border: 2px dashed #ccc; padding: 30px; margin-top:15px; cursor:pointer;" onclick="document.getElementById('file-in').click()">
                <p>ðŸ“‚ Click to Upload Word File (.docx)</p>
                <input type="file" id="file-in" accept=".docx" hidden onchange="handleFile(this.files[0])">
            </div>
            <p id="file-name" style="color:var(--primary); font-weight:bold;"></p>
        </div>

        <!-- Text Paste -->
        <div id="tab-text" class="tab-content">
            <textarea id="text-in" placeholder="Paste your Hindi/Marathi/English text here..."></textarea>
        </div>

        <!-- Controls -->
        <div class="controls">
            <select id="size-sel" onchange="updatePageSize()">
                <option value="a4">Size: A4</option>
                <option value="a3">Size: A3</option>
                <option value="letter">Size: Letter</option>
            </select>
            <button class="action-btn" id="convert-btn" onclick="processConversion()">Convert to Preview</button>
            <button class="action-btn" id="dl-btn" style="display:none; background:#10b981;" onclick="downloadPDF()">Download PDF</button>
        </div>
        <p id="status" style="margin-top:10px; font-weight:bold;"></p>
    </div>

    <!-- Preview -->
    <div id="preview-wrapper">
        <div id="preview-container">
            <div id="document-content"></div>
        </div>
    </div>
</div>

<script>
    // Config
    let mode = 'file';
    let currentFile = null;

    // Elements
    const previewWrapper = document.getElementById('preview-wrapper');
    const container = document.getElementById('preview-container');
    const contentBox = document.getElementById('document-content');
    const status = document.getElementById('status');

    function setMode(m) {
        mode = m;
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        
        if(m === 'file') {
            document.querySelector('[onclick="setMode(\'file\')"]').classList.add('active');
            document.getElementById('tab-file').classList.add('active');
        } else {
            document.querySelector('[onclick="setMode(\'text\')"]').classList.add('active');
            document.getElementById('tab-text').classList.add('active');
        }
        reset();
    }

    function handleFile(file) {
        if(file) {
            currentFile = file;
            document.getElementById('file-name').innerText = "Selected: " + file.name;
        }
    }

    function updatePageSize() {
        const size = document.getElementById('size-sel').value;
        // Set explicit CSS widths to match PDF dimensions so preview is accurate
        if(size === 'a4') {
            container.style.width = '210mm';
            container.style.minHeight = '297mm';
        } else if (size === 'a3') {
            container.style.width = '297mm';
            container.style.minHeight = '420mm';
        } else if (size === 'letter') {
            container.style.width = '216mm';
            container.style.minHeight = '279mm';
        }
    }

    function reset() {
        previewWrapper.style.display = 'none';
        contentBox.innerHTML = '';
        document.getElementById('dl-btn').style.display = 'none';
        document.getElementById('convert-btn').style.display = 'inline-block';
        status.innerText = '';
    }

    function processConversion() {
        status.innerText = "Processing...";
        status.style.color = "blue";

        if(mode === 'file') {
            if(!currentFile) { status.innerText = "Please select a file"; return; }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                mammoth.convertToHtml({arrayBuffer: e.target.result})
                .then(result => {
                    renderPreview(result.value);
                })
                .catch(err => status.innerText = "Error reading file.");
            };
            reader.readAsArrayBuffer(currentFile);
        } else {
            const text = document.getElementById('text-in').value;
            if(!text) { status.innerText = "Please enter text"; return; }
            
            // FIX FOR TEXT CUTTING OFF: 
            // Replace newlines with breaks, but handle standard paragraphs better
            let formattedHtml = text.split('\n').map(line => {
                // If line is empty, it's a spacer
                if(line.trim() === '') return '<br>';
                // Wrap in P tag for proper breaking
                return `<p>${line}</p>`;
            }).join('');
            
            renderPreview(formattedHtml);
        }
    }

    function renderPreview(html) {
        contentBox.innerHTML = html;
        previewWrapper.style.display = 'block';
        
        // Ensure images don't overflow
        const imgs = contentBox.querySelectorAll('img');
        imgs.forEach(img => img.style.maxWidth = "100%");

        document.getElementById('convert-btn').style.display = 'none';
        document.getElementById('dl-btn').style.display = 'inline-block';
        status.innerText = "Preview generated. Click Download to save.";
        status.style.color = "green";
        
        // Scroll to preview
        previewWrapper.scrollIntoView({behavior:'smooth'});
    }

    function downloadPDF() {
        status.innerText = "Generating PDF (Please wait)...";
        const element = container; // We capture the container which has the exact width
        const size = document.getElementById('size-sel').value;

        // Optimization for PDF generation
        const opt = {
            margin:       0, // We have padding in the container CSS, so PDF margin is 0
            filename:     'document.pdf',
            image:        { type: 'jpeg', quality: 0.98 },
            html2canvas:  { 
                scale: 2, // Higher quality
                useCORS: true, 
                letterRendering: true // Helps with fonts
            },
            jsPDF:        { unit: 'mm', format: size, orientation: 'portrait' },
            pagebreak:    { mode: ['avoid-all', 'css', 'legacy'] } // CRITICAL FIX for cutting text
        };

        html2pdf().set(opt).from(element).save().then(() => {
            status.innerText = "Download Started!";
            setTimeout(() => {
                document.getElementById('convert-btn').style.display = 'inline-block';
                document.getElementById('dl-btn').style.display = 'none';
            }, 2000);
        });
    }

    // Initialize default size
    updatePageSize();
</script>

</body>
</html>
